<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulasi Gerak Jatuh Bebas</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(to bottom, #a8e6cf, #dcedc1);
            min-height: 100vh;
            padding: 20px;
        }

        .simulation-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            gap: 20px;
        }

        .panel {
            background: rgba(255, 255, 255, 0.7);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .panel-left, .panel-right {
            flex: 0 0 300px;
        }

        .panel-center {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .control-group {
            margin-bottom: 20px;
        }

        .control-group h3 {
            margin-bottom: 10px;
            color: #2d5016;
        }

        #object-selection label {
            display: block;
            padding: 8px;
            margin: 5px 0;
            background: #fff;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        #object-selection label:hover {
            background: #e8f5e9;
            transform: translateX(5px);
        }

        #object-selection input[type="radio"] {
            margin-right: 10px;
        }

        button {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border: none;
            border-radius: 8px;
            background: #4caf50;
            color: white;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }

        button:hover {
            background: #45a049;
            transform: scale(1.02);
        }

        #simulationCanvas {
            border: 3px solid #2d5016;
            border-radius: 10px;
            background: linear-gradient(to bottom, #87ceeb 0%, #87ceeb 70%, #8b7355 70%, #8b7355 100%);
            cursor: crosshair;
        }

        .simulation-controls {
            display: flex;
            gap: 10px;
        }

        .simulation-controls button {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            font-size: 24px;
            background: #333;
            color: white;
        }

        .simulation-controls button:hover {
            background: #555;
        }

        .info-display {
            background: #fff;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .info-display .speedometer,
        .info-display .stopwatch {
            font-weight: bold;
            color: #2d5016;
            margin-top: 10px;
        }

        .info-display .value {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            background: #f0f0f0;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            margin: 5px 0;
        }

        .graph-container {
            width: 100%;
            height: 300px;
            background: white;
            border-radius: 10px;
            padding: 10px;
        }

        canvas#speedTimeChart {
            width: 100% !important;
            height: 100% !important;
        }

        .drag-instruction {
            text-align: center;
            padding: 10px;
            background: #fff3cd;
            border-radius: 8px;
            margin-bottom: 10px;
            font-size: 14px;
            color: #856404;
        }

        .height-indicator {
            position: fixed;
            background: rgba(255, 255, 255, 0.9);
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            font-weight: bold;
            pointer-events: none;
            display: none;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div class="simulation-container">
        <div class="panel panel-left">
            <div class="control-group">
                <h3>Drag Objects to Platforms</h3>
                <div id="object-selection">
                    <label><input type="radio" name="object" value="pingpong" checked> Pingpong Ball</label>
                    <label><input type="radio" name="object" value="golf"> Golf Ball</label>
                    <label><input type="radio" name="object" value="baseball"> Base Ball</label>
                    <label><input type="radio" name="object" value="football"> Foot Ball</label>
                    <label><input type="radio" name="object" value="basketball"> Basket Ball</label>
                </div>
            </div>

            <div class="control-group">
                <h3>Choose Atmosphere</h3>
                <label><input type="radio" name="atmosphere" value="air" checked> Air</label><br>
                <label><input type="radio" name="atmosphere" value="vacuum"> Vacuum (no air)</label>
            </div>

            <div class="drag-instruction">
                üí° Drag objek ke canvas untuk menempatkannya di ketinggian yang diinginkan!
            </div>
            
            <div class="info-display" id="info-display-left"> 
                <div class="speedometer">Speed (m/s)</div>
                <div class="value" id="speed-left">0.00</div>
                <div class="stopwatch">Drop Time (s)</div>
                <div class="value" id="time-left">0.00</div>
                <div class="speedometer">Height (m)</div>
                <div class="value" id="height-left">-</div>
            </div>
        </div>

        <div class="panel panel-center">
            <canvas id="simulationCanvas" width="350" height="550"></canvas>
            <div class="simulation-controls">
                <button id="play-btn">‚ñ∂</button>
                <button id="pause-btn">‚ùö‚ùö</button>
                <button id="reset-btn">‚Üª</button>
            </div>
        </div>

        <div class="panel panel-right">
            <div class="control-group">
                <h3>Graph of Speed vs Time</h3>
                <div class="graph-container">
                    <canvas id="speedTimeChart"></canvas>
                </div>
            </div>
            <div class="info-display" id="info-display-right">
                <div class="speedometer">Speed (m/s)</div>
                <div class="value" id="speed-right">0.00</div>
                <div class="stopwatch">Drop time (s)</div>
                <div class="value" id="time-right">0.00</div>
                <div class="speedometer">height (m)</div>
                <div class="value" id="height-right">-</div>
            </div>
        </div>
    </div>

    <div class="height-indicator" id="height-indicator"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script>
        const canvas = document.getElementById('simulationCanvas');
        const ctx = canvas.getContext('2d');
        
        const g = 9.81;
        const airDensity = 1.225;
        const maxHeight = 75;
        const groundY = canvas.height - 50;
        const pixelsPerMeter = (canvas.height - 100) / maxHeight;

        const balls = {
            pingpong: { name: 'Pingpong', color: '#FF8C42', mass: 0.0027, drag: 0.47, radius: 0.02, displayRadius: 12 },
            golf: { name: 'Golf', color: '#FFFFFF', mass: 0.046, drag: 0.24, radius: 0.0214, displayRadius: 12 },
            baseball: { name: 'Baseball', color: '#FFE5E5', mass: 0.145, drag: 0.35, radius: 0.037, displayRadius: 14 },
            football: { name: 'Football', color: '#000000', mass: 0.43, drag: 0.25, radius: 0.11, displayRadius: 18 },
            basketball: { name: 'Basketball', color: '#FF6B35', mass: 0.624, drag: 0.5, radius: 0.12, displayRadius: 20 }
        };

        let selectedBall = 'pingpong';
        let atmosphere = 'air';
        let isRunning = false;
        let isDragging = false;
        let dragBall = null;

        let leftBall = null;
        let rightBall = null;

        let startTime = 0;
        let animationId = null;

        let speedChart = null;

        document.querySelectorAll('input[name="object"]').forEach(function(radio) {
            radio.addEventListener('change', function(e) {
                selectedBall = e.target.value;
            });
        });

        document.querySelectorAll('input[name="atmosphere"]').forEach(function(radio) {
            radio.addEventListener('change', function(e) {
                atmosphere = e.target.value;
                resetSimulation();
            });
        });

        document.getElementById('play-btn').addEventListener('click', startSimulation);
        document.getElementById('pause-btn').addEventListener('click', pauseSimulation);
        document.getElementById('reset-btn').addEventListener('click', resetSimulation);

        canvas.addEventListener('mousedown', handleMouseDown);
        canvas.addEventListener('mousemove', handleMouseMove);
        canvas.addEventListener('mouseup', handleMouseUp);
        canvas.addEventListener('mouseleave', handleMouseUp);

        function handleMouseDown(e) {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            if (leftBall && isPointInBall(x, y, leftBall)) {
                isDragging = true;
                dragBall = leftBall;
            } else if (rightBall && isPointInBall(x, y, rightBall)) {
                isDragging = true;
                dragBall = rightBall;
            } else {
                const height = getHeightFromY(y);
                if (height > 0 && height <= maxHeight) {
                    const side = x < canvas.width / 2 ? 'left' : 'right';
                    const ballX = side === 'left' ? canvas.width * 0.3 : canvas.width * 0.7;
                    
                    const newBall = {
                        type: selectedBall,
                        x: ballX,
                        y: y,
                        initialY: y,
                        initialHeight: height,
                        velocity: 0,
                        time: 0,
                        side: side,
                        isActive: false
                    };

                    if (side === 'left') {
                        leftBall = newBall;
                    } else {
                        rightBall = newBall;
                    }

                    isDragging = true;
                    dragBall = newBall;
                }
            }
        }

        function handleMouseMove(e) {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            if (isDragging && dragBall) {
                const height = getHeightFromY(y);
                if (height > 0 && height <= maxHeight) {
                    dragBall.y = y;
                    dragBall.initialY = y;
                    dragBall.initialHeight = height;
                    dragBall.velocity = 0;
                    dragBall.time = 0;
                    
                    if (x < canvas.width / 2) {
                        dragBall.side = 'left';
                        dragBall.x = canvas.width * 0.3;
                        if (dragBall === rightBall) {
                            rightBall = null;
                            leftBall = dragBall;
                        }
                    } else {
                        dragBall.side = 'right';
                        dragBall.x = canvas.width * 0.7;
                        if (dragBall === leftBall) {
                            leftBall = null;
                            rightBall = dragBall;
                        }
                    }

                    const indicator = document.getElementById('height-indicator');
                    indicator.style.display = 'block';
                    indicator.style.left = (e.clientX + 10) + 'px';
                    indicator.style.top = (e.clientY - 30) + 'px';
                    indicator.textContent = height.toFixed(1) + ' m';
                }
                draw();
            }
        }

        function handleMouseUp(e) {
            isDragging = false;
            dragBall = null;
            document.getElementById('height-indicator').style.display = 'none';
            updateHeightDisplays();
        }

        function isPointInBall(x, y, ball) {
            const dx = x - ball.x;
            const dy = y - ball.y;
            const distance = Math.sqrt(dx * dx + dy * dy);
            return distance <= balls[ball.type].displayRadius;
        }

        function getHeightFromY(y) {
            return (groundY - y) / pixelsPerMeter;
        }

        function getYFromHeight(height) {
            return groundY - (height * pixelsPerMeter);
        }

        function updateHeightDisplays() {
            if (leftBall) {
                document.getElementById('height-left').textContent = leftBall.initialHeight.toFixed(1);
            } else {
                document.getElementById('height-left').textContent = '-';
            }

            if (rightBall) {
                document.getElementById('height-right').textContent = rightBall.initialHeight.toFixed(1);
            } else {
                document.getElementById('height-right').textContent = '-';
            }
        }

        function startSimulation() {
            if (!leftBall && !rightBall) {
                alert('Silakan drag objek ke canvas terlebih dahulu!');
                return;
            }

            isRunning = true;
            startTime = Date.now();

            if (leftBall && !leftBall.isActive) {
                leftBall.isActive = true;
                leftBall.startTime = Date.now();
                leftBall.time = 0;
                leftBall.velocity = 0;
            }
            if (rightBall && !rightBall.isActive) {
                rightBall.isActive = true;
                rightBall.startTime = Date.now();
                rightBall.time = 0;
                rightBall.velocity = 0;
            }

            initChart();
            animate();
        }

        function pauseSimulation() {
            isRunning = false;
            if (animationId) {
                cancelAnimationFrame(animationId);
            }
        }

        function resetSimulation() {
            isRunning = false;
            if (animationId) {
                cancelAnimationFrame(animationId);
            }

            if (leftBall) {
                leftBall.y = leftBall.initialY;
                leftBall.velocity = 0;
                leftBall.time = 0;
                leftBall.isActive = false;
            }

            if (rightBall) {
                rightBall.y = rightBall.initialY;
                rightBall.velocity = 0;
                rightBall.time = 0;
                rightBall.isActive = false;
            }

            document.getElementById('speed-left').textContent = '0.00';
            document.getElementById('time-left').textContent = '0.00';
            document.getElementById('speed-right').textContent = '0.00';
            document.getElementById('time-right').textContent = '0.00';

            if (speedChart) {
                speedChart.data.datasets[0].data = [];
                speedChart.data.datasets[1].data = [];
                speedChart.update();
            }

            draw();
        }

        function animate() {
            if (!isRunning) return;

            const now = Date.now();
            let allFinished = true;

            if (leftBall && leftBall.isActive) {
                const ballTime = (now - leftBall.startTime) / 1000;
                updateBall(leftBall, ballTime);
                if (leftBall.y < groundY) {
                    allFinished = false;
                } else {
                    leftBall.isActive = false;
                }
            }

            if (rightBall && rightBall.isActive) {
                const ballTime = (now - rightBall.startTime) / 1000;
                updateBall(rightBall, ballTime);
                if (rightBall.y < groundY) {
                    allFinished = false;
                } else {
                    rightBall.isActive = false;
                }
            }

            draw();
            updateDisplays();
            updateChart();

            if (allFinished) {
                isRunning = false;
            } else {
                animationId = requestAnimationFrame(animate);
            }
        }

        function updateBall(ball, currentTime) {
            ball.time = currentTime;
            const ballData = balls[ball.type];

            let velocity, height;

            if (atmosphere === 'vacuum') {
                velocity = g * ball.time;
                height = ball.initialHeight - 0.5 * g * ball.time * ball.time;
            } else {
                const A = Math.PI * ballData.radius * ballData.radius;
                const k = 0.5 * ballData.drag * airDensity * A;
                const terminalVel = Math.sqrt((ballData.mass * g) / k);
                velocity = terminalVel * Math.tanh((g * ball.time) / terminalVel);
                
                const integral = (terminalVel * terminalVel / g) * Math.log(Math.cosh((g * ball.time) / terminalVel));
                height = ball.initialHeight - integral;
            }

            ball.velocity = velocity;
            
            if (height <= 0) {
                ball.y = groundY;
                ball.velocity = velocity;
            } else {
                ball.y = getYFromHeight(height);
            }
        }

        function updateDisplays() {
            if (leftBall && leftBall.isActive) {
                document.getElementById('speed-left').textContent = leftBall.velocity.toFixed(2);
                document.getElementById('time-left').textContent = leftBall.time.toFixed(2);
            }

            if (rightBall && rightBall.isActive) {
                document.getElementById('speed-right').textContent = rightBall.velocity.toFixed(2);
                document.getElementById('time-right').textContent = rightBall.time.toFixed(2);
            }
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#87ceeb');
            gradient.addColorStop(0.85, '#87ceeb');
            gradient.addColorStop(0.85, '#8b7355');
            gradient.addColorStop(1, '#5d4e37');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            ctx.strokeStyle = '#333';
            ctx.fillStyle = '#333';
            ctx.font = '10px Arial';
            ctx.lineWidth = 1;

            for (let h = 0; h <= maxHeight; h += 5) {
                const y = getYFromHeight(h);
                ctx.beginPath();
                ctx.moveTo(10, y);
                ctx.lineTo(20, y);
                ctx.stroke();
                ctx.fillText(h + 'm', 22, y + 3);

                ctx.beginPath();
                ctx.moveTo(canvas.width - 20, y);
                ctx.lineTo(canvas.width - 10, y);
                ctx.stroke();
            }

            ctx.strokeStyle = '#333';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(0, groundY);
            ctx.lineTo(canvas.width, groundY);
            ctx.stroke();

            if (leftBall) {
                drawBall(leftBall);
            }
            if (rightBall) {
                drawBall(rightBall);
            }
        }

        function drawBall(ball) {
            const ballData = balls[ball.type];
            ctx.fillStyle = ballData.color;
            ctx.beginPath();
            ctx.arc(ball.x, ball.y, ballData.displayRadius, 0, Math.PI * 2);
            ctx.fill();

            if (ball.type === 'football') {
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.stroke();
            }

            ctx.strokeStyle = '#000';
            ctx.lineWidth = 1;
            ctx.stroke();
        }

        function initChart() {
            if (speedChart) {
                speedChart.destroy();
            }

            const chartCanvas = document.getElementById('speedTimeChart');
            speedChart = new Chart(chartCanvas, {
                type: 'line',
                data: {
                    datasets: [
                        {
                            label: 'Kiri',
                            data: [],
                            borderColor: '#FF6384',
                            backgroundColor: 'rgba(255, 99, 132, 0.1)',
                            borderWidth: 2,
                            pointRadius: 0
                        },
                        {
                            label: 'Kanan',
                            data: [],
                            borderColor: '#36A2EB',
                            backgroundColor: 'rgba(54, 162, 235, 0.1)',
                            borderWidth: 2,
                            pointRadius: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            type: 'linear',
                            title: { display: true, text: 'Waktu (s)' },
                            min: 0,
                            max: 10
                        },
                        y: {
                            title: { display: true, text: 'Kecepatan (m/s)' },
                            min: 0,
                            max: 50
                        }
                    },
                    animation: false
                }
            });
        }

        function updateChart() {
            if (!speedChart) return;

            if (leftBall && leftBall.isActive) {
                speedChart.data.datasets[0].data.push({
                    x: leftBall.time,
                    y: leftBall.velocity
                });
            }

            if (rightBall && rightBall.isActive) {
                speedChart.data.datasets[1].data.push({
                    x: rightBall.time,
                    y: rightBall.velocity
                });
            }

            speedChart.update('none');
        }

        draw();
    </script>
</body>
</html>